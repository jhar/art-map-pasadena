<!DOCTYPE html>
<html>
  <head>
    <title>Art Map Pasadena</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- build:css build.css -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/nav.css">
    <link rel="stylesheet" href="css/list.css">
    <link rel="stylesheet" href="css/map.css">
    <link rel="stylesheet" href="css/info.css">
    <link rel="stylesheet" href="css/footer.css">
    <!-- endbuild -->
  </head>
  <body>

  <!-- Facebook API -->
  <div id="fb-root"></div>
  <script>
    // Async JS handler
    var fbLoaded, gmLoaded, appLoaded = false;
    var jsIsReady = function(service) {
      if (service === 'facebook') fbLoaded = true;
      if (service === undefined) gmLoaded = true;
      if (service === 'app') appLoaded = true;
      
      if (gmLoaded && appLoaded) mapInit();
      if (fbLoaded && gmLoaded && appLoaded) appInit();
    };

    // Load the Facebook Graph API
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '695503930593092',
        xfbml      : false,
        version    : 'v2.7'
      });

      jsIsReady('facebook');
    };

    (function(d, s, id) {
       var js, fjs = d.getElementsByTagName(s)[0];
       if (d.getElementById(id)) {return;}
       js = d.createElement(s); js.id = id;
       js.src = "//connect.facebook.net/en_US/sdk.js";
       fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>



  <!-- Login View -->
  <div class="shim" data-bind="updateVisible: !showApp()"></div>
  <div class="login-view" data-bind="visible: !showApp()">
    <div class="login-inner">
      <span class="login-a">Art</span>
      <span class="login-b">Map</span>
      <span class="login-c">Pasadena</span>
      <div class="fb-auth" data-bind="click: function(){login();}">
        Do it.
        <img class="fb-auth-icon" src="images/press-button.png">
      </div>
    </div>
  </div>

  <!-- Main App -->
  <div class="app" data-bind="updateVisible: showApp()">

     <!-- Nav View -->
      <div class="nav-view">
        <div class="list-toggle" data-bind="click: toggleList">
          <img class="nav-hamburger" data-bind="visible: !showList()" src="images/list.png">
          <img class="nav-hamburger" data-bind="visible: showList()" src="images/black-x.png">
        </div>
        <input class="nav-search" type="text" data-bind="event: {keyup: liveSearch}" placeholder="Search Locations">
        <div class="logout-wrapper" data-bind="click: function(){logout();}">
          <img class="logout-icon" src="images/white-account.png">
        </div>
      </div>

      <!-- List View -->
      <div class="list-view" data-bind="visible: showList">
        <div class="list-group" data-bind="foreach: locations">
          <div class="list-group-item" data-bind="click: $parent.clickedListItem, fadeVisible: visible">
            <i class="mdi-maps-pin-drop"></i>
            <span data-bind="text: name"></span>
          </div>
        </div>
      </div>

      <!-- Map View -->
      <div class="map-view">
        <div data-bind="visible: gmErr()">
          An error with Google Maps occurred and the page may not be displaying correctly. Please refresh or try again later.
        </div>
        <div id="map"></div>
      </div>

      <!-- Info View -->
      <div id="info-view" data-bind="visible: showInfo">
        <div data-bind="visible: fbErr()">
          An error with Facebook occurred and the page may not be displaying correctly. Please refresh or try again later.
        </div>

        <!-- General Information -->
        <div class=".general-info" data-bind="if: !anyMarkerHasBeenClicked()">
          <img class="cover-photo" src="" />
          <p class=".about-app">
            Art Map Pasadena was originally written in 2015 by Justin Harrison. The project is now being revised, updated, upgraded, etc.
          </p>
        </div>
        
        <!-- Location Specific Information -->
        <div data-bind="visible: anyMarkerHasBeenClicked">
          <img class="cover-photo" data-bind="attr: {src: activeLocationCover()}" alt=""/>
          <h4 data-bind="visible: activeLocationEvents().length > 0">Upcoming Events</h4>
          <h5 data-bind="if: anyMarkerHasBeenClicked, visible: activeLocationEvents().length < 1">No upcoming events to show.</h5>
          <div class="list-group" data-bind="foreach: activeLocationEvents.slice(0).reverse()">
            <div class="list-group-item" data-toggle="collapse" data-bind="attr: {href: '#' + id}">
              <div class="row-picture">
                <img class="circle img-responsive" data-bind="attr: {src: cover}" alt="">
              </div>
              <div class="row-content">
                <span class="list-group-item-heading" data-bind="text: name, attr: {href: '#' + id}"></span>
                <p class="list-group-item-text collapse" data-bind="attr: {id: id}, text: description"></p>
              </div>
              <div class="list-group-separator"></div>
            </div>
          </div>
        </div>

      </div>

      <!-- Footer View -->
      <div class="footer-view" data-bind="click: toggleInfo">

        <!-- State 1: no-info-view, no location selected-->
        <div class="footer-wrapper" data-bind="if: (!showInfo() && !anyMarkerHasBeenClicked())">
          <div class="explore-wrap">
            <img class="explore-up" src="images/explore-white.png">
          </div>
          <span class="app-info">Art Map Pasadena</span>
        </div>

        <!-- State 2: no-info-view, location selected-->
        <div class="footer-wrapper" data-bind="if: (!showInfo() && anyMarkerHasBeenClicked())">
         <span class="location-info" data-bind="text: activeLocationName"></span>
         <img class="trigger-up" src="images/white-chevron-up.png">
        </div>

        <!-- State 3: info-view shown-->
        <div class="footer-wrapper" data-bind="if: showInfo">
          <img class="trigger-down" src="images/white-chevron-down.png">
        </div>
        
      </div>

  </div>

  <footer>
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXSNMOBqv06qzdPYMb14q9S_AhufB4jHo&callback=jsIsReady"></script>
    <!-- build:js js/build.js -->
    <script src="js/knockout-latest.debug.js"></script>
    <script src="js/data.js"></script>
    <script src="js/location.js"></script>
    <script src="js/viewModel.js"></script>
    <script src="js/map.js"></script>
    <script src="js/customBindings.js"></script>
    <script src="js/app.js"></script>
    <!-- endbuild -->
  </footer>

</body>
</html>