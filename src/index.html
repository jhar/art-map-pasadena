<!DOCTYPE html>
<html>
  <head>
    <title>Art Map Pasadena</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- build:css build.css -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/nav.css">
    <link rel="stylesheet" href="css/list.css">
    <link rel="stylesheet" href="css/map.css">
    <link rel="stylesheet" href="css/info.css">
    <!-- endbuild -->
  </head>
  <body>

  <!-- Facebook API -->
  <div id="fb-root"></div>
  <script>
    // Async JS handler
    var fbLoaded, gmLoaded, appLoaded = false;
    var jsIsReady = function(service) {
      if (service === 'facebook') fbLoaded = true;
      if (service === undefined) gmLoaded = true;
      if (service === 'app') appLoaded = true;
      
      if (gmLoaded && appLoaded) mapInit();
      if (fbLoaded && gmLoaded && appLoaded) appInit();
    };

    // Load the Facebook Graph API
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '695503930593092',
        xfbml      : false,
        version    : 'v2.7'
      });

      jsIsReady('facebook');
    };

    (function(d, s, id) {
       var js, fjs = d.getElementsByTagName(s)[0];
       if (d.getElementById(id)) {return;}
       js = d.createElement(s); js.id = id;
       js.src = "//connect.facebook.net/en_US/sdk.js";
       fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>



  <!-- Login View -->
  <div class="login-view">
    <div class="login-inner">
      <span class="login-a">Art</span>
      <span class="login-b">Map</span>
      <span class="login-c">Pasadena</span>
      <div class="fb-auth" data-bind="click: login">
        <img class="fb-auth-icon" src="images/login.png">
      </div>
    </div>
  </div>

  <!-- Main App -->
  <div class="app display-none">

     <!-- Nav View -->
      <div class="nav-view">
        <div class="list-toggle" data-bind="click: toggleList">
          <img class="nav-hamburger" data-bind="visible: !showList()" src="images/list.png">
          <img class="nav-hamburger" data-bind="visible: showList()" src="images/black-x.png">
        </div>
        <!-- Trigger -->
        <div class="trigger">
          <!-- State 1: show info false, no location selected-->
          <div class="title-and-trigger" data-bind="if: (!showInfo() && !anyMarkerHasBeenClicked())">
            <span class="trigger-info">Art Map Pasadena</span>
            <div class="trigger-wrap">
              <img class="trigger-down" src="images/arrow-down.png" data-bind="click: infoUp">
            </div>
          </div>
          <!-- State 2: show info false, location selected-->
          <div class="title-and-trigger" data-bind="if: (!showInfo() && anyMarkerHasBeenClicked())">
            <span class="trigger-info" data-bind="text: activeLocationName"></span>
            <div class="trigger-wrap">
              <img class="trigger-down" src="images/arrow-down.png" data-bind="click: infoUp">
            </div>
          </div>
          <!-- State 3: info-view shown-->
          <div class="title-and-trigger" data-bind="if: showInfo">
            <span class="trigger-info" data-bind="text: activeLocationName"></span>
            <div class="trigger-wrap">
              <img class="trigger-down" src="images/arrow-up.png" data-bind="click: infoDown">
            </div>
          </div>
        </div>
        <input class="nav-search" type="text" data-bind="event: {keyup: liveSearch}" placeholder="Search Locations">
      </div>

      <!-- List View -->
      <div class="list-view" data-bind="visible: showList">
        <div class="list-group" data-bind="foreach: locations">
          <div class="list-group-item" data-bind="click: $parent.clickedListItem, fadeVisible: visible">
            <img class="list-group-icon" src="images/list-icon.png">
            <span class="list-group-text" data-bind="text: name"></span>
          </div>
        </div>
        <div class="list-group-item" data-bind="click: logout">
          <img class="list-group-icon" src="images/logout.png">
          <span class="list-group-text">Logout of Facebook</span>
        </div>
      </div>

      <!-- Map View -->
      <div class="map-view">
        <div data-bind="visible: gmErr()">
          An error with Google Maps occurred and the page may not be displaying correctly. Please refresh or try again later.
        </div>
        <div id="map"></div>
      </div>

      <!-- Info View -->
      <div class="info-view display-none">
        <div data-bind="visible: fbErr()">
          An error with Facebook occurred and the page may not be displaying correctly. Please refresh or try again later.
        </div>
        <div class="location-container">
          <div class="cover-container">
            <img class="cover-photo" data-bind="attr: {src: activeLocationCover().source, 'data-offsety': activeLocationCover().offset_y}" onload="vm.changeOffsetY(this, false)" alt=""/>
            <div class="cover-scrim"></div>
            <span class="location-title" data-bind="if: activeLocationEvents().length > 0">Upcoming Events</span>
          </div>
        </div>
        <div class="separator"></div>
        <h5 data-bind="if: activeLocationEvents().length < 1">No upcoming events to show.</h5>
        <div class="events-container" data-bind="foreach: activeLocationEvents.slice(0).reverse()">
          <div class="event" data-bind="attr: {href: '#' + id}">
            <div class="event-image-container" data-bind="with: cover">
              <img class="event-image" data-bind="attr: { src: source , 'data-offsety': offset_y }" onload="vm.changeOffsetY(this, true)" alt="">
            </div>
            <div class="event-title-container">
              <span class="event-title" data-bind="text: name, attr: {href: '#' + id}"></span>
            </div>
            <div class="event-extra-container display-none">
              <p class="event-description" data-bind="attr: {id: id}, text: description"></p>
            </div>
          </div>
        </div>
      </div>
  
  </div>

  <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXSNMOBqv06qzdPYMb14q9S_AhufB4jHo&callback=jsIsReady"></script>
  <!-- build:js js/build.js -->
  <script src="js/knockout-latest.debug.js"></script>
  <script src="js/data.js"></script>
  <script src="js/location.js"></script>
  <script src="js/viewModel.js"></script>
  <script src="js/mapStyle.js"></script>
  <script src="js/map.js"></script>
  <script src="js/init.js"></script>
  <!-- endbuild -->

</body>
</html>